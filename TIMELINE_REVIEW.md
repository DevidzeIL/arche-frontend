# üîç –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–≤—å—é Timeline —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏

## üìä –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ Geometry/Camera**
   - `TimelineGeometry` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `scrollYear` (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–º–µ—Ä—ã)
   - –ü—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `yearToScreenX` / `screenXToYear` —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –¶–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞ –≤—Å–µ–≥–¥–∞ `viewportWidth / 2`

2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ (Rows)**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º –∑–∞–º–µ—Ç–æ–∫ (`rowTypes.ts`)
   - –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ (focus window)
   - Bucket stacking –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è overlaps

3. **–î–≤—É—Ö–∑–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
   - `CardsArea` (–≤–µ—Ä—Ö) –∏ `TrackArea` (–Ω–∏–∑) —á–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `overflow-visible` –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫

4. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π clamp –¥–ª—è center-based –∫–∞–º–µ—Ä—ã**
   - `clampScrollYear` —É—á–∏—Ç—ã–≤–∞–µ—Ç `yearsPerScreen / 2`

---

## ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥: CardLayer + useGreedyLayout**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `CardLayer.tsx` –∏ `useGreedyLayout.ts` –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `TimeRuler.tsx`
- –í–º–µ—Å—Ç–æ –Ω–∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `RowsLayer` ‚Üí `RowCardsLayer`
- –ù–æ —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –æ—Å—Ç–∞–ª—Å—è –∏ –º–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ

**–§–∞–π–ª—ã:**
- `src/components/timeline/components/CardLayer.tsx` (132 —Å—Ç—Ä–æ–∫–∏) - **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**
- `src/components/timeline/hooks/useGreedyLayout.ts` (58 —Å—Ç—Ä–æ–∫) - **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**
- `src/components/timeline/core/greedyLayout.ts` (143 —Å—Ç—Ä–æ–∫–∏) - **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ deprecated
- –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π - –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

---

### 2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `CardLayer` –∏ `RowCardsLayer` –¥–µ–ª–∞—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ:
  - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç `year` ‚Üí `screenX` —á–µ—Ä–µ–∑ `yearToScreenX`
  - –í—ã—á–∏—Å–ª—è—é—Ç `cardLeft = centerX - CARD_WIDTH / 2`
  - –û–±–µ—Ä—Ç—ã–≤–∞—é—Ç `TimelineCard` –≤ `div` —Å `absolute` –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–ö–æ–¥:**
```typescript
// CardLayer.tsx (—Å—Ç—Ä–æ–∫–∏ 44-70)
const cardPositions = useMemo(() => {
  return layouts.map(layout => {
    const centerX = yearToScreenX(layout.year, scrollYear, geometry);
    const cardLeft = centerX - geometry.cardWidth / 2;
    // ...
  });
}, [layouts, notesMap, scrollYear, geometry]);

// RowCardsLayer.tsx (—Å—Ç—Ä–æ–∫–∏ 67-90)
const cardPositions = useMemo(() => {
  return bucketLayout.items.map(item => {
    const centerX = yearToScreenX(item.year, scrollYear, geometry);
    const cardLeft = centerX - CARD_WIDTH / 2;
    // ...
  });
}, [bucketLayout.items, notesMap, scrollYear, geometry]);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ —É—Ç–∏–ª–∏—Ç—É `computeCardPosition(year, scrollYear, geometry)`
- –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ `RowCardsLayer`, –µ—Å–ª–∏ `CardLayer` –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω

---

### 3. **TimelineCard —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `layout` prop**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `TimelineCard` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `layout: CardLayoutItem`
- –ù–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ wrapper `div` —Å `left/top`
- `layout` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è "legacy" –æ–±—ä–µ–∫—Ç–∞ —Å –ø—É—Å—Ç—ã–º–∏ `viewX/viewY`

**–ö–æ–¥:**
```typescript
// RowCardsLayer.tsx (—Å—Ç—Ä–æ–∫–∏ 123-136)
const legacyLayout = {
  id: note.id,
  year: note.timeline?.displayYear ?? 0,
  startYear: note.timeline?.startYear ?? 0,
  endYear: note.timeline?.endYear ?? 0,
  type: note.type || 'note',
  priority: 0,
  laneIndex: 0,
  viewX: 0,  // –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  viewY: 0,  // –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  width: CARD_WIDTH,
  height: CARD_HEIGHT,
};
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å `TimelineCard` props: —É–±—Ä–∞—Ç—å `layout`, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `note`, `year`, `startYear`, `endYear`
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∏–ø `TimelineCardProps` –±–µ–∑ `layout`

---

### 4. **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `CARD_WIDTH` –∏ `CARD_HEIGHT` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
  - `RowCardsLayer.tsx`: `CARD_WIDTH = 320`, `CARD_HEIGHT = 160`
  - `TimelineCard.tsx`: `CARD_WIDTH = 320`, `CARD_HEIGHT = 160`
  - `projection.ts`: `cardWidth: 320` (–≤ `TimelineGeometry`)
  - `CardLayer.tsx`: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `geometry.cardWidth`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í—ã–Ω–µ—Å—Ç–∏ –≤ –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Å—Ç–∞–Ω—Ç: `src/components/timeline/constants.ts`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `geometry.cardWidth` –≤–µ–∑–¥–µ, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

---

### 5. **Bucket layout: –Ω–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö overlaps**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `computeBucketLayout` –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∑–∞–º–µ—Ç–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –±–∞–∫–µ—Ç–∞–º
- –ù–æ –µ—Å–ª–∏ –¥–≤–∞ –±–∞–∫–µ—Ç–∞ –±–ª–∏–∑–∫–æ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É, –∫–∞—Ä—Ç–æ—á–∫–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏

**–ö–æ–¥:**
```typescript
// bucketLayout.ts (—Å—Ç—Ä–æ–∫–∏ 52-120)
// –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ bucketIndex, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ overlaps
const bucketIndex = computeBucketKey(year, bucketSizeYears);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –µ—Å–ª–∏ `cardLeft + CARD_WIDTH > nextCardLeft`, —Å–¥–≤–∏–Ω—É—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –≤–ø—Ä–∞–≤–æ
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —É–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, force-directed)

---

### 6. **RowMarkersLayer: –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `RowMarkersLayer` –≤—ã—á–∏—Å–ª—è–µ—Ç density bins –¥–ª—è –≤—Å–µ–≥–æ –≤–∏–¥–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
- –ù–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –≤—Å–µ bins, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –≤–Ω–µ —ç–∫—Ä–∞–Ω–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ `startX/endX`, –Ω–æ bins –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è

**–ö–æ–¥:**
```typescript
// RowMarkersLayer.tsx (—Å—Ç—Ä–æ–∫–∏ 68-71)
const densityBins = useMemo(() => {
  const numBins = Math.min(240, Math.floor(geometry.viewportWidth / 3));
  return computeDensityBins(notes, visibleRange, numBins);
}, [notes, visibleRange, geometry.viewportWidth]);

// –ó–∞—Ç–µ–º —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è (—Å—Ç—Ä–æ–∫–∏ 83-89)
if (endX < -10 || startX > geometry.viewportWidth + 10) return null;
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å bins –î–û —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞, –∞ –Ω–µ –≤–æ –≤—Ä–µ–º—è
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `IntersectionObserver` –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏

---

### 7. **RowsLayer: —Å–∫—Ä—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—ã—Å–æ—Ç—É**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `RowsLayer` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏ (—Å—Ç—Ä–æ–∫–∏ 54-60)
- –ù–æ `geometry.cardsAreaHeight` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ `viewportHeight - TRACK_AREA_HEIGHT`
- –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫ –º–∞–ª–æ, –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ

**–ö–æ–¥:**
```typescript
// RowsLayer.tsx (—Å—Ç—Ä–æ–∫–∏ 47-64)
const rowPositions = useMemo(() => {
  let currentTop = 0;
  const positions: Array<{ rowKey: RowKey; top: number }> = [];
  
  ROW_ORDER.forEach(rowKey => {
    const config = getRowConfig(rowKey);
    if (notesByRow[rowKey].length > 0) {  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–º–µ—Ç–∫–∏
      positions.push({ rowKey, top: currentTop });
      currentTop += config.height;
    }
  });
  
  return positions;
}, [notesByRow]);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è—Ç—å `cardsAreaHeight` –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–∏–º—ã—Ö —Å—Ç—Ä–æ–∫
- –ò–ª–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ (–¥–∞–∂–µ –ø—É—Å—Ç—ã–µ) –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

---

### 8. **TimelineCard: –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `TimelineCard` –ø–∞—Ä—Å–∏—Ç `note.body` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 46-71)
- –≠—Ç–æ —Ç—è–∂–µ–ª–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ
- –õ—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ —É—Ç–∏–ª–∏—Ç—É –∏–ª–∏ –≤—ã—á–∏—Å–ª—è—Ç—å –ø—Ä–∏ –æ–±–æ–≥–∞—â–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–æ–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í—ã–Ω–µ—Å—Ç–∏ –≤ `enrichAllNotes` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —É—Ç–∏–ª–∏—Ç—É `extractFirstImage(note.body)`
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `note.timeline.firstImage`

---

### 9. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `TimelineCard` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `onError` –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –±–∏—Ç—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 138-140)
- –ù–æ –Ω–µ—Ç fallback –∏–ª–∏ placeholder

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å placeholder –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ò–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–∫–æ–Ω–∫—É —Ç–∏–ø–∞ –∑–∞–º–µ—Ç–∫–∏ –≤–º–µ—Å—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

---

### 10. **Overflow indicators: –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã `+N` –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫—Ä—ã—Ç—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
- –ù–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–ö–æ–¥:**
```typescript
// RowCardsLayer.tsx (—Å—Ç—Ä–æ–∫–∏ 162-174)
<div
  key={`overflow-${bucketIndex}`}
  className="absolute pointer-events-none ..."  // –ù–ï–¢ pointer-events-auto!
  // ...
>
  +{count}
</div>
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `pointer-events-auto` –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
- –ü—Ä–∏ –∫–ª–∏–∫–µ: —É–≤–µ–ª–∏—á–∏—Ç—å `maxStackPerBucket` –¥–ª—è —ç—Ç–æ–≥–æ –±–∞–∫–µ—Ç–∞ –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ —Å–ø–∏—Å–∫–æ–º

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 11. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ useMemo**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `RowCardsLayer` –∏ `RowMarkersLayer` –º–Ω–æ–≥–æ `useMemo` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `scrollYear` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
- –ù–µ—Ç –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useMemo` –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
- –ò–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `useCallback` –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π

---

### 12. **–ù–µ—Ç –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `RowsLayer` —Ä–µ–Ω–¥–µ—Ä–∏—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –≤–Ω–µ viewport
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `react-window` –∏–ª–∏ `react-virtualized` –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
- –ò–ª–∏ –≤—ã—á–∏—Å–ª—è—Ç—å –≤–∏–¥–∏–º—ã–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ `scrollTop` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

### 13. **–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π:
  - `computeBucketLayout`
  - `clampScrollYear`
  - `yearToScreenX` / `screenXToYear`
  - `isInFocusWindow`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —É—Ç–∏–ª–∏—Ç
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `vitest` –∏–ª–∏ `jest`

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)

1. **–£–¥–∞–ª–∏—Ç—å –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥**
   - `CardLayer.tsx`
   - `useGreedyLayout.ts`
   - `greedyLayout.ts` (–∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ deprecated)

2. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å TimelineCard**
   - –£–±—Ä–∞—Ç—å `layout` prop
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –∏–∑ `note`

3. **–í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**
   - –°–æ–∑–¥–∞—Ç—å `constants.ts` —Å `CARD_WIDTH`, `CARD_HEIGHT`, `ROW_HEIGHT`, etc.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ)

4. **–£–ª—É—á—à–∏—Ç—å bucket layout**
   - –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö overlaps
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è

5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å RowMarkersLayer**
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å bins –¥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é

6. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å overflow indicators**
   - –ö–ª–∏–∫ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å–∫—Ä—ã—Ç—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

7. **–í—ã–Ω–µ—Å—Ç–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
   - –í `enrichAllNotes` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —É—Ç–∏–ª–∏—Ç—É

8. **–î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç—Ä–æ–∫**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `react-window` –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

9. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã**
   - Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —É—Ç–∏–ª–∏—Ç

10. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
    - Placeholder –¥–ª—è –±–∏—Ç—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    - Error boundaries –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: 8/10
- ‚úÖ –•–æ—Ä–æ—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚ùå –ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥ –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 7/10
- ‚úÖ –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚ùå –ù–µ—Ç –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Å—á–µ—Ç—ã –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ

### –ö–æ–¥ –∫–∞—á–µ—Å—Ç–≤–æ: 6/10
- ‚úÖ TypeScript strict
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏
- ‚ùå –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ props
- ‚ùå –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤

### UX: 8/10
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏
- ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ overflow indicators
- ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

- [ ] –£–¥–∞–ª–∏—Ç—å `CardLayer.tsx`
- [ ] –£–¥–∞–ª–∏—Ç—å `useGreedyLayout.ts`
- [ ] –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å `greedyLayout.ts` –∫–∞–∫ deprecated
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å `TimelineCard` props
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `constants.ts`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö overlaps –≤ bucket layout
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `RowMarkersLayer` –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å overflow indicators
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —É—Ç–∏–ª–∏—Ç—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

