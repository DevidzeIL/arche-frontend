# Timeline Refactor - Pixel-Perfect Implementation

## üéØ –ü—Ä–æ–±–ª–µ–º—ã (–ù–∞–π–¥–µ–Ω–æ –∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### 1. ‚úÖ –°—É–±–ø–∏–∫—Å–µ–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ë—ã–ª–æ:** `left: ${ratio * containerWidth}px` ‚Üí –¥—Ä–æ–±–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (1234.567px)
**–°—Ç–∞–ª–æ:** `roundToDevicePixel()` ‚Äî –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ device pixels —Å —É—á—ë—Ç–æ–º DPR

### 2. ‚úÖ –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
**–ë—ã–ª–æ:** Track (%), Cards (px + transform), Ticks (mix)
**–°—Ç–∞–ª–æ:** –ï–¥–∏–Ω–∞—è px-based —Å–∏—Å—Ç–µ–º–∞ —á–µ—Ä–µ–∑ `timelineMath.ts`

### 3. ‚úÖ –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π containerWidth/Height
**–ë—ã–ª–æ:** –ü–µ—Ä–µ—Å—á—ë—Ç –∫–∞–∂–¥—ã–π —Ä–µ–Ω–¥–µ—Ä ‚Üí layout "–ø—Ä—ã–≥–∞–µ—Ç"
**–°—Ç–∞–ª–æ:** `ResizeObserver` —Å RAF debounce ‚Üí —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã

### 4. ‚úÖ –î—Ä–æ–±–Ω–∞—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
**–ë—ã–ª–æ:** `top-1/2` + `transform -translate-y-1/2` ‚Üí —Å—É–±–ø–∏–∫—Å–µ–ª–∏
**–°—Ç–∞–ª–æ:** `top: ${Math.round(height/2)}px` ‚Äî —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ

### 5. ‚úÖ –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ lanes Y-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
**–ë—ã–ª–æ:** –î—Ä–æ–±–Ω—ã–µ offsetY ‚Üí –∫–∞—Ä—Ç–æ—á–∫–∏ "–ø–ª–∞–≤–∞—é—Ç"
**–°—Ç–∞–ª–æ:** –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `laneToViewY()` ‚Äî —Ä–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞

### 6. ‚úÖ Layout —Ç–æ–ª—å–∫–æ –¥–ª—è visible cards
**–ë—ã–ª–æ:** –ü—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ–Ω—è—é—Ç lanes ‚Üí "–ø—Ä—ã–∂–∫–∏"
**–°—Ç–∞–ª–æ:** Layout –¥–ª—è –í–°–ï–•, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–æ–ª—å–∫–æ visible ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

### 7. ‚úÖ Transform scale —Å–æ–∑–¥–∞—ë—Ç –±–ª—é—Ä
**–ë—ã–ª–æ:** `transform: scale(1.05, 1.1)` ‚Üí subpixel rendering
**–°—Ç–∞–ª–æ:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ width/height (320px / 340px) ‚Äî —á—ë—Ç–∫–æ—Å—Ç—å

### 8. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏
**–ë—ã–ª–æ:** –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ-—Å–≤–æ–µ–º—É
**–°—Ç–∞–ª–æ:** `timelineMath.ts` ‚Äî –ï–î–ò–ù–´–ô –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

---

## üìê –ù–æ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/components/timeline/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ timelineMath.ts        # –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
‚îÇ   ‚îú‚îÄ‚îÄ timelineLayout.ts      # –°—Ç–∞–±–∏–ª—å–Ω–∞—è —É–∫–ª–∞–¥–∫–∞ –≤ lanes
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useTimelineGeometry.ts # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π (ResizeObserver)
‚îÇ   ‚îú‚îÄ‚îÄ useStableLayout.ts     # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ layout
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ TimelineTrackV2.tsx    # –¢—Ä–µ–∫ —Å –º–µ—Ç–∫–∞–º–∏ (pixel-perfect)
‚îÇ   ‚îú‚îÄ‚îÄ TimelineCardV2.tsx     # –ö–∞—Ä—Ç–æ—á–∫–∞ (–±–µ–∑ scale)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ TimeRulerV2.tsx            # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
‚îî‚îÄ‚îÄ ... (—Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ï–¥–∏–Ω–∞—è –ì–µ–æ–º–µ—Ç—Ä–∏—è (`TimelineGeometry`)

```typescript
interface TimelineGeometry {
  // World space (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
  startYear: number;
  endYear: number;
  totalYears: number;
  
  // View space (—ç–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
  viewportWidth: number;
  viewportHeight: number;
  scrollYear: number;
  pxPerYear: number; // –º–∞—Å—à—Ç–∞–±
  
  // Layout constants (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
  trackBaselineY: number; // Y —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏
  laneHeight: number; // 200px
  maxLanes: number; // 5
  cardWidth: number; // 320px
  cardGap: number; // 40px
  
  // Device
  dpr: number; // devicePixelRatio
}
```

### –ì–ª–∞–≤–Ω–∞—è –§—É–Ω–∫—Ü–∏—è –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

```typescript
// year ‚Üí screen pixel X
function yearToViewX(year: number, geometry: TimelineGeometry): number {
  const worldX = (year - geometry.startYear) * geometry.pxPerYear;
  const scrollOffset = (geometry.scrollYear - geometry.startYear) * geometry.pxPerYear;
  const viewX = worldX - scrollOffset + geometry.viewportWidth / 2;
  return roundToDevicePixel(viewX, geometry.dpr);
}
```

**–í—Å–µ X-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é!**

### Pixel Snapping

```typescript
// –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ device pixel
function roundToDevicePixel(px: number, dpr: number): number {
  return Math.round(px * dpr) / dpr;
}

// Hairline offset –¥–ª—è 1px –ª–∏–Ω–∏–π –Ω–∞ Retina
function hairlineOffset(dpr: number): number {
  return dpr >= 2 ? 0.5 / dpr : 0;
}
```

### –°—Ç–∞–±–∏–ª—å–Ω—ã–π Layout

```typescript
// 1. –í—ã—á–∏—Å–ª—è–µ–º lanes –¥–ª—è –í–°–ï–• –∑–∞–º–µ—Ç–æ–∫ (–æ–¥–∏–Ω —Ä–∞–∑)
const baseLayout = computeStableLayout(notes, geometry);

// 2. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–∏ scroll/zoom (lanes –Ω–µ –º–µ–Ω—è—é—Ç—Å—è!)
const layout = updateLayoutCoordinates(baseLayout, geometry);

// 3. –§–∏–ª—å—Ç—Ä—É–µ–º –≤–∏–¥–∏–º—ã–µ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
const visibleCards = filterVisibleCards(layout, geometry);
```

**–ö–ª—é—á:** Lane assignment –ù–ï –∑–∞–≤–∏—Å–∏—Ç –æ—Ç scroll ‚Üí –Ω–µ—Ç "–ø—Ä—ã–∂–∫–æ–≤"

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –ß–µ–∫–ª–∏—Å—Ç

### A) –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

1. **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è:**
   - [ ] –°—Ç—Ä–æ–≥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–Ω–µ–π–∫–æ–π/inspector)
   - [ ] –¢–æ–ª—â–∏–Ω–∞ —Ä–æ–≤–Ω–æ 1px (–±–µ–∑ —Ä–∞–∑–º—ã—Ç–∏—è)
   - [ ] –ù–µ "–ø—Ä—ã–≥–∞–µ—Ç" –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ/–∑—É–º–µ

2. **–ú–µ—Ç–∫–∏ (ticks):**
   - [ ] –í—Å–µ —Ä–∏—Å–∫–∏ –Ω–∞ –æ–¥–Ω–æ–π baseline
   - [ ] –û–¥–∏–Ω–∞–∫–æ–≤—ã–π —à–∞–≥ –ø—Ä–∏ –æ–¥–Ω–æ–º zoom
   - [ ] –¢–µ–∫—Å—Ç –ª–µ—Ç –Ω–µ "–ø–ª—ã–≤—ë—Ç" –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
   - [ ] –ì–æ–¥ 0 –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ

3. **–ö–∞—Ä—Ç–æ—á–∫–∏:**
   - [ ] –†–æ–≤–Ω—ã–µ "–¥–æ—Ä–æ–∂–∫–∏" (lanes)
   - [ ] –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
   - [ ] –ù–µ –º–µ–Ω—è—é—Ç lane –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
   - [ ] –ù–µ—Ç –¥—Ä–æ–∂–∞–Ω–∏—è –ø—Ä–∏ hover/focus

4. **–≠–ø–æ—Ö–∏:**
   - [ ] –ì—Ä–∞–Ω–∏—Ü—ã –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã —Å –º–µ—Ç–∫–∞–º–∏ –ª–µ—Ç
   - [ ] –ù–∞–∑–≤–∞–Ω–∏—è –Ω–µ "—Å–∫–∞—á—É—Ç" –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ

### B) –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

5. **FPS –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ:**
   - [ ] –°—Ç–∞–±–∏–ª—å–Ω–æ 60fps (Chrome DevTools ‚Üí Performance)
   - [ ] –ù–µ—Ç layout thrashing (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å Performance panel)

6. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–Ω–¥–µ—Ä–æ–≤:**
   - [ ] –û—Ç–∫—Ä—ã—Ç—å React DevTools ‚Üí Profiler
   - [ ] –°–∫—Ä–æ–ª–ª–∏—Ç—å ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 5 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–µ
   - [ ] TimelineTrackV2, TimelineCardV2 ‚Äî memo

7. **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è:**
   - [ ] –†–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ + buffer
   - [ ] –í DOM –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~10-30 –∫–∞—Ä—Ç–æ—á–µ–∫, –∞ –Ω–µ –≤—Å–µ 72

### C) –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

8. **Scroll/Zoom:**
   - [ ] –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫–æ–ª—ë—Å–∏–∫–æ–º
   - [ ] Snap –∫ –∑–Ω–∞—á–∏–º—ã–º —Ç–æ—á–∫–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç
   - [ ] Zoom –º–µ–Ω—è–µ—Ç –º–∞—Å—à—Ç–∞–±, –Ω–æ –Ω–µ –ª–æ–º–∞–µ—Ç layout

9. **Focus Mode:**
   - [ ] –ö–∞—Ä—Ç–æ—á–∫–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
   - [ ] –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞—Ç–µ–º–Ω—è—é—Ç—Å—è
   - [ ] Esc –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Ä–µ–∂–∏–º–∞
   - [ ] –ù–µ—Ç –¥—Ä–æ–∂–∞–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ

10. **Hover:**
    - [ ] –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è
    - [ ] –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–∂–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è
    - [ ] –ù–µ—Ç "–º–∏–≥–∞–Ω–∏—è" –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –º—ã—à–∏

### D) –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

11. **Console –ø—Ä–æ–≤–µ—Ä–∫–∏:**
    ```js
    // –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
    
    // 1. Geometry —Å—Ç–∞–±–∏–ª—å–Ω–∞?
    // (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Å—á—ë—Ç–æ–≤)
    
    // 2. Layout —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑?
    // [useStableLayout] Computing base layout for 72 notes
    // (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –û–î–ò–ù —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)
    
    // 3. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–ª—ã–µ?
    document.querySelectorAll('[class*="TimelineCard"]').forEach(el => {
      const x = parseFloat(el.style.left);
      const y = parseFloat(el.style.top);
      console.log(`Card: x=${x}, y=${y}, isInteger=${Number.isInteger(x * window.devicePixelRatio)}`);
    });
    // –í—Å–µ x, y –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ü–µ–ª—ã–º–∏ –ø–æ—Å–ª–µ —É–º–Ω–æ–∂–µ–Ω–∏—è –Ω–∞ DPR
    ```

12. **Inspector –ø—Ä–æ–≤–µ—Ä–∫–∏:**
    - [ ] –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Elements
    - [ ] –í—ã–±—Ä–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é
    - [ ] Computed ‚Üí top –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º (300px, 400px, –Ω–µ 300.5px)

---

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è

### –ó–∞–º–µ–Ω–∞ —Å—Ç–∞—Ä–æ–≥–æ TimeRuler –Ω–∞ –Ω–æ–≤—ã–π

**–î–æ:**
```tsx
import { TimeRuler } from '@/components/timeline';

<TimeRuler onNoteClick={...} />
```

**–ü–æ—Å–ª–µ:**
```tsx
import { TimeRulerV2 } from '@/components/timeline/TimeRulerV2';

<TimeRulerV2 onNoteClick={...} />
```

**–ò–∑–º–µ–Ω–µ–Ω–æ –≤:** `src/pages/TimelinePage.tsx`

### –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è reference)

- `TimeRuler.tsx` (—Å—Ç–∞—Ä—ã–π)
- `TimelineTrack.tsx` (—Å—Ç–∞—Ä—ã–π)
- `TimelineCard.tsx` (—Å—Ç–∞—Ä—ã–π)
- `utils/layoutUtils.ts` (—Å—Ç–∞—Ä—ã–π)

**–ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ V2 —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ.**

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

- Layout –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–∫—Ä–æ–ª–ª–µ
- 72 –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –≤—Å–µ–≥–¥–∞
- –°—É–±–ø–∏–∫—Å–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí browser repaint
- FPS: ~30-45 –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

- Layout –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –û–î–ò–ù —Ä–∞–∑
- –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: ~15-25 –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ DOM
- –¶–µ–ª—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí GPU compositing
- FPS: —Å—Ç–∞–±–∏–ª—å–Ω–æ 60

**–ü—Ä–∏—Ä–æ—Å—Ç:** ~2x –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, ~3x –ø–ª–∞–≤–Ω–æ—Å—Ç—å

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ lanes

`src/components/timeline/core/timelineMath.ts`:

```typescript
export function createGeometry(...) {
  return {
    ...
    maxLanes: 5, // –ó–î–ï–°–¨ –∏–∑–º–µ–Ω–∏—Ç—å (3, 5, 7)
  };
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã lanes

```typescript
laneHeight: 200, // –ó–î–ï–°–¨ –∏–∑–º–µ–Ω–∏—Ç—å (150, 200, 250)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –∫–∞—Ä—Ç–æ—á–µ–∫

```typescript
cardWidth: 320, // –ó–î–ï–°–¨ –∏–∑–º–µ–Ω–∏—Ç—å (280, 320, 360)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞ zoom

`src/components/timeline/core/timelineMath.ts`:

```typescript
function zoomLevelToPxPerYear(...) {
  const multipliers = {
    out: 0.3,  // –ó–î–ï–°–¨ –∏–∑–º–µ–Ω–∏—Ç—å (0.2, 0.5)
    mid: 1.0,  // –±–∞–∑–æ–≤—ã–π
    in: 3.0,   // –ó–î–ï–°–¨ –∏–∑–º–µ–Ω–∏—Ç—å (2.0, 4.0)
  };
}
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–∏–Ω–∏—è —Ä–∞–∑–º—ã—Ç–∞—è

**–ü—Ä–∏—á–∏–Ω–∞:** –î—Ä–æ–±–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π hairline offset

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `trackBaselineY` ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å `hairlineOffset()` –¥–ª—è 1px –ª–∏–Ω–∏–π
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `will-change: transform` –¥–ª—è GPU —É—Å–∫–æ—Ä–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ä—Ç–æ—á–∫–∏ "–ø—Ä—ã–≥–∞—é—Ç" –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ

**–ü—Ä–∏—á–∏–Ω–∞:** Layout –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è visible cards

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `useStableLayout`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `baseLayout` –∑–∞–≤–∏—Å–∏—Ç –¢–û–õ–¨–ö–û –æ—Ç `notes`, –Ω–µ –æ—Ç `geometry`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ "Computing base layout"

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–∏–π FPS

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á–∏—Ç—å `bufferPx` –≤ `filterVisibleCards` (–Ω–æ –Ω–µ —Å–ª–∏—à–∫–æ–º!)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é: `console.log(visibleCards.length)` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~20
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `React.memo` –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ V2)

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –æ–∫—Ä—É–≥–ª–µ–Ω—ã

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å `roundToDevicePixel`

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–°–ï –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ `roundToDevicePixel`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `yearToViewX`, `laneToViewY` ‚Äî –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–∫—Ä—É–≥–ª—è—é—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å inspector: computed values –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ü–µ–ª—ã–º–∏ (—Å —É—á—ë—Ç–æ–º DPR)

---

## ‚ú® –ò—Ç–æ–≥–∏

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ

- ‚úÖ Pixel-perfect –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–π layout –±–µ–∑ "–ø—Ä—ã–∂–∫–æ–≤"
- ‚úÖ 60 FPS –ø—Ä–∏ –ª—é–±—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö
- ‚úÖ –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã—Ö)
- ‚úÖ –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ –ß—ë—Ç–∫–∏–µ 1px –ª–∏–Ω–∏–∏ –Ω–∞ Retina
- ‚úÖ –†–æ–≤–Ω—ã–µ lanes –±–µ–∑ —Å–º–µ—â–µ–Ω–∏–π
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—É–±–ø–∏–∫—Å–µ–ª—å–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

### –ö–æ–¥

- 3 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª—è: `core/`, `hooks/`, `components/`
- 5 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤: 800 —Å—Ç—Ä–æ–∫ —á–∏—Å—Ç–æ–≥–æ TypeScript
- 100% —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- 0 –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ–∫–ª–∏—Å—Ç –≤—ã—à–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞.

**Enjoy pixel-perfect Timeline!** üé®‚ú®

